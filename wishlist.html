<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Christmas Wishlist 2025</title>
  <style>
    :root {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      color: #1f2a37;
      background: #f5f5f5;
    }

    body {
      margin: 0;
      padding: 20px;
      background: linear-gradient(135deg, #f9fbff, #f5f5f5);
      min-height: 100vh;
    }

    .container {
      max-width: 720px;
      margin: 0 auto;
      background: #fff;
      border-radius: 16px;
      padding: 32px 24px;
      box-shadow: 0 15px 40px rgba(15, 23, 42, 0.08);
    }

    h1 {
      text-align: center;
      color: #b91c1c;
      margin-bottom: 0.5rem;
    }

    p.description {
      text-align: center;
      color: #475569;
      margin-bottom: 2rem;
    }

    form {
      display: grid;
      gap: 1rem;
    }

    label {
      font-weight: 600;
      margin-bottom: 0.25rem;
      display: block;
      color: #0f172a;
    }

    input[type="text"],
    textarea {
      width: 100%;
      padding: 0.85rem 1rem;
      border: 1px solid #cbd5f5;
      border-radius: 10px;
      font-size: 1rem;
      font-family: inherit;
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
      box-sizing: border-box;
    }

    input[type="text"]:focus,
    textarea:focus {
      border-color: #ef4444;
      outline: none;
      box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.2);
    }

    textarea {
      min-height: 100px;
      resize: vertical;
    }

    button {
      background: linear-gradient(135deg, #f97316, #ef4444);
      color: #fff;
      border: none;
      padding: 0.95rem 1.5rem;
      border-radius: 999px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.1s ease, box-shadow 0.2s ease;
    }

    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      box-shadow: none;
    }

    button:not(:disabled):hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 25px rgba(239, 68, 68, 0.35);
    }

    .error-message {
      color: #b91c1c;
      font-size: 0.9rem;
      min-height: 1.2rem;
    }

    .success-message {
      color: #15803d;
      font-size: 0.9rem;
      min-height: 1.2rem;
    }

    .wishes-section {
      margin-top: 2.5rem;
    }

    .wishes-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .wishes-header h2 {
      margin: 0;
      color: #0f172a;
    }

    .wish-list {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .wish-card {
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      padding: 1rem 1.25rem;
      background: #fdfdfd;
      box-shadow: 0 4px 16px rgba(15, 23, 42, 0.06);
    }

    .wish-card h3 {
      margin: 0;
      color: #dc2626;
      font-size: 1.15rem;
    }

    .wish-card .item {
      font-size: 1.05rem;
      margin: 0.35rem 0;
      color: #0f172a;
      font-weight: 600;
    }

    .wish-card .meta {
      font-size: 0.9rem;
      color: #475569;
    }

    .wish-card a {
      color: #2563eb;
      text-decoration: none;
      font-weight: 500;
    }

    .wish-card a:hover {
      text-decoration: underline;
    }

    @media (max-width: 640px) {
      .container {
        padding: 24px 18px;
      }

      button {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Christmas Wishlist 2025</h1>
    <p class="description">Add your name and what youâ€™d like. Anyone with this link can see and add items.</p>

    <form id="wishlist-form">
      <div>
        <label for="name">Your name *</label>
        <input type="text" id="name" name="name" placeholder="e.g., Alex" required />
      </div>
      <div>
        <label for="item">Wishlist item *</label>
        <input type="text" id="item" name="item" placeholder="e.g., Cozy sweater" required />
      </div>
      <div>
        <label for="link">Link (optional)</label>
        <input type="text" id="link" name="link" placeholder="https://..." />
      </div>
      <div>
        <label for="notes">Notes (optional)</label>
        <textarea id="notes" name="notes" placeholder="Color, size, where to find it..."></textarea>
      </div>
      <button type="submit">Add to wishlist</button>
      <div class="error-message" id="error-message"></div>
      <div class="success-message" id="success-message"></div>
    </form>

    <section class="wishes-section">
      <div class="wishes-header">
        <h2>All wishes</h2>
        <span id="wish-count">0 wishes</span>
      </div>
      <div class="wish-list" id="wish-list">
        <p id="loading-message">Loading wishes...</p>
      </div>
    </section>
  </div>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbyz2n4kwyurJm1cAGggxumY9M9StLXXuuQATT1lqqatbGVihzzNdHWhWAN09fbiakHa/exec";

    const form = document.getElementById("wishlist-form");
    const errorMessage = document.getElementById("error-message");
    const successMessage = document.getElementById("success-message");
    const wishListEl = document.getElementById("wish-list");
    const wishCountEl = document.getElementById("wish-count");
    const loadingMessage = document.getElementById("loading-message");

    const formatDate = (isoString) => {
      if (!isoString) return "";
      const date = new Date(isoString);
      return date.toLocaleString(undefined, {
        year: "numeric",
        month: "short",
        day: "numeric",
        hour: "2-digit",
        minute: "2-digit"
      });
    };

    const renderWishes = (wishes = []) => {
      wishListEl.innerHTML = "";

      if (!wishes.length) {
        wishListEl.innerHTML = '<p>No wishes yet. Be the first to add one!</p>';
        wishCountEl.textContent = "0 wishes";
        return;
      }

      wishes.forEach((wish) => {
        const card = document.createElement("article");
        card.className = "wish-card";

        const linkMarkup = wish.link
          ? `<div><strong>Link:</strong> <a href="${wish.link}" target="_blank" rel="noopener">${wish.link}</a></div>`
          : "";

        const notesMarkup = wish.notes ? `<div><strong>Notes:</strong> ${wish.notes}</div>` : "";

        card.innerHTML = `
          <h3>${wish.name || "Anonymous"}</h3>
          <p class="item">${wish.item || "(no item)"}</p>
          ${linkMarkup}
          ${notesMarkup}
          <p class="meta">Added on ${formatDate(wish.timestamp)}</p>
        `;

        wishListEl.appendChild(card);
      });

      wishCountEl.textContent = wishes.length === 1 ? "1 wish" : `${wishes.length} wishes`;
    };

    const fetchWishes = async () => {
      loadingMessage.textContent = "Loading wishes...";
      try {
        const response = await fetch(API_URL);
        if (!response.ok) {
          throw new Error("Failed to load wishes");
        }
        const wishes = await response.json();
        const sorted = wishes.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
        renderWishes(sorted);
      } catch (error) {
        console.error(error);
        wishListEl.innerHTML = '<p style="color:#b91c1c;">Unable to load wishes right now. Please try again later.</p>';
      } finally {
        loadingMessage.textContent = "";
      }
    };

    const submitWish = async (wishData) => {
      const submitWish = async (wishData) => {
      try {
        const response = await fetch(API_URL, {
          method: "POST",
          // Important: no "application/json" header, so no CORS preflight
          // headers: { "Content-Type": "text/plain;charset=utf-8" }, // optional
          body: JSON.stringify(wishData)
        });

        const result = await response.json();
        if (!response.ok || !result.success) {
          throw new Error(result.message || "Failed to add wish");
        }

        successMessage.textContent = "Wish added!";
        errorMessage.textContent = "";
        form.reset();
        fetchWishes();
      } catch (error) {
        successMessage.textContent = "";
        errorMessage.textContent = error.message || "Something went wrong";
      } finally {
        setTimeout(() => {
          successMessage.textContent = "";
        }, 4000);
      }
    };

    form.addEventListener("submit", (event) => {
      event.preventDefault();
      errorMessage.textContent = "";
      successMessage.textContent = "";

      const name = form.name.value.trim();
      const item = form.item.value.trim();
      const link = form.link.value.trim();
      const notes = form.notes.value.trim();

      if (!name || !item) {
        errorMessage.textContent = "Please fill out your name and the wishlist item.";
        return;
      }

      const wishData = {
        name,
        item,
        link,
        notes
      };

      submitWish(wishData);
    });

    fetchWishes();
  </script>
</body>
</html>
